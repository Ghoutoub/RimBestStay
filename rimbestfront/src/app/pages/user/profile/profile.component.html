<div class="profile-container pb-5" *ngIf="me && !loading; else stateTemplate">
  <!-- Profile Header Hero -->
  <div class="row mb-5">
    <div class="col-12">
      <div class="premium-card bg-premium-gradient p-5 text-white position-relative shadow-lg border-0 overflow-hidden">
        <!-- Abstract background blobs for premium feel -->
        <div class="position-absolute translate-middle"
          style="top: 0; right: 0; width: 300px; height: 300px; background: rgba(255,255,255,0.1); border-radius: 50%; filter: blur(40px);">
        </div>

        <div class="row align-items-center position-relative">
          <div class="col-auto">
            <div class="bg-white rounded-circle p-1 shadow-lg">
              <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center"
                style="width: 100px; height: 100px;">
                <i class="bi bi-person text-white display-4"></i>
              </div>
            </div>
          </div>
          <div class="col">
            <div class="d-flex align-items-center gap-3 mb-1">
              <h1 class="h2 mb-0 fw-bold">{{ me.nom }}</h1>
              <span *ngIf="isAdmin" class="badge bg-danger rounded-pill px-3 shadow-sm">Administrateur</span>
              <span *ngIf="isPartenaire"
                class="badge bg-warning text-dark rounded-pill px-3 shadow-sm">Partenaire</span>
              <span *ngIf="isClient" class="badge bg-info text-white rounded-pill px-3 shadow-sm">Client</span>
            </div>
            <p class="mb-0 opacity-75 fs-5"><i class="bi bi-envelope me-2"></i>{{ me.email }}</p>
          </div>
          <div class="col-md-auto mt-4 mt-md-0 d-flex gap-2">
            <a routerLink="/profile/edit"
              class="btn btn-light rounded-pill px-4 shadow-sm border-0 fw-bold text-primary">
              <i class="bi bi-pencil-square me-2"></i>Modifier
            </a>
            <a routerLink="/profile/password" class="btn btn-outline-light rounded-pill px-4 border-2 fw-bold">
              <i class="bi bi-shield-lock me-2"></i>Sécurité
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row g-4">
    <!-- Main Info Grid -->
    <div class="col-lg-8">
      <div class="premium-card p-4 mb-4">
        <h4 class="fw-bold mb-4 d-flex align-items-center">
          <span class="bg-primary bg-opacity-10 p-2 rounded-3 me-3">
            <i class="bi bi-card-text text-primary"></i>
          </span>
          Détails du Compte
        </h4>

        <div class="row g-4">
          <div class="col-md-6">
            <label class="text-muted small text-uppercase fw-bold mb-1">Nom complet</label>
            <div class="p-3 bg-light rounded-3 d-flex align-items-center">
              <i class="bi bi-person-fill text-primary me-3 fs-5"></i>
              <span class="fw-semibold">{{ me.nom || '-' }}</span>
            </div>
          </div>

          <div class="col-md-6">
            <label class="text-muted small text-uppercase fw-bold mb-1">Adresse Email</label>
            <div class="p-3 bg-light rounded-3 d-flex align-items-center">
              <i class="bi bi-envelope-fill text-primary me-3 fs-5"></i>
              <span class="fw-semibold">{{ me.email || '-' }}</span>
            </div>
          </div>

          <div class="col-md-6">
            <label class="text-muted small text-uppercase fw-bold mb-1">Téléphone</label>
            <div class="p-3 bg-light rounded-3 d-flex align-items-center">
              <i class="bi bi-telephone-fill text-primary me-3 fs-5"></i>
              <span class="fw-semibold">{{ me.telephone || 'Non renseigné' }}</span>
            </div>
          </div>

          <div class="col-md-6">
            <label class="text-muted small text-uppercase fw-bold mb-1">Adresse physique</label>
            <div class="p-3 bg-light rounded-3 d-flex align-items-center">
              <i class="bi bi-geo-alt-fill text-primary me-3 fs-5"></i>
              <span class="fw-semibold text-truncate">{{ me.adresse || 'Non renseignée' }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Specific Section based on Role -->
      <div class="premium-card p-4" *ngIf="isPartenaire">
        <h4 class="fw-bold mb-4 d-flex align-items-center">
          <span class="bg-warning bg-opacity-10 p-2 rounded-3 me-3">
            <i class="bi bi-building text-warning"></i>
          </span>
          Détails Professionnels
        </h4>
        <div class="row g-4">
          <div class="col-md-6">
            <label class="text-muted small text-uppercase fw-bold mb-1">Nom de l'entreprise</label>
            <p class="fs-5 fw-bold mb-0">{{ me.nomEntreprise || '-' }}</p>
          </div>
          <div class="col-md-6">
            <label class="text-muted small text-uppercase fw-bold mb-1">Numéro SIRET</label>
            <p class="fs-5 fw-bold mb-0">{{ me.siret || '-' }}</p>
          </div>
          <div class="col-md-6">
            <label class="text-muted small text-uppercase fw-bold mb-1">Contact Pro</label>
            <p class="fs-5 fw-semibold mb-0 text-muted">{{ me.telephonePro || 'N/A' }}</p>
          </div>
          <div class="col-md-6">
            <label class="text-muted small text-uppercase fw-bold mb-1">Site Internet</label>
            <p class="mb-0">
              <a *ngIf="me.siteWeb" [href]="me.siteWeb" target="_blank" class="text-decoration-none fw-bold">
                {{ me.siteWeb }} <i class="bi bi-box-arrow-up-right small ms-1"></i>
              </a>
              <span *ngIf="!me.siteWeb" class="text-muted">Non renseigné</span>
            </p>
          </div>
        </div>
      </div>

      <div class="premium-card p-4 text-center" *ngIf="isAdmin">
        <div class="py-4">
          <div class="bg-danger bg-opacity-10 rounded-circle d-inline-flex p-4 mb-3">
            <i class="bi bi-shield-check text-danger display-4"></i>
          </div>
          <h4 class="fw-bold">Accès Administrateur</h4>
          <p class="text-muted">Département: <span class="fw-bold text-dark">{{ me.departement || 'Central' }}</span>
          </p>
          <div class="mt-4">
            <a routerLink="/admin/users" class="btn btn-danger rounded-pill px-4">Gérer la plateforme</a>
          </div>
        </div>
      </div>
    </div>

    <!-- Sidebar Grid -->
    <div class="col-lg-4">
      <div class="premium-card p-4 mb-4">
        <h5 class="fw-bold mb-3">Sécurité & Paramètres</h5>
        <p class="text-muted small mb-4">Gérez la sécurité de votre compte et vos préférences de navigation.</p>

        <div class="list-group list-group-flush border-0">
          <a routerLink="/profile/password"
            class="list-group-item list-group-item-action border-0 px-0 d-flex align-items-center">
            <span class="bg-light p-2 rounded-3 me-3"><i class="bi bi-key"></i></span>
            <div class="flex-grow-1">
              <div class="fw-bold">Mot de passe</div>
              <div class="text-muted small">Dernière modification il y a 3 mois</div>
            </div>
            <i class="bi bi-chevron-right text-muted small"></i>
          </a>

          <a routerLink="/profile/edit"
            class="list-group-item list-group-item-action border-0 px-0 d-flex align-items-center mt-2">
            <span class="bg-light p-2 rounded-3 me-3"><i class="bi bi-pencil"></i></span>
            <div class="flex-grow-1">
              <div class="fw-bold">Informations Personnelles</div>
              <div class="text-muted small">Mettre à jour vos coordonnées</div>
            </div>
            <i class="bi bi-chevron-right text-muted small"></i>
          </a>
        </div>
      </div>

      <div class="premium-card border-0 bg-primary bg-opacity-10 p-4">
        <div class="text-center">
          <h5 class="fw-bold text-primary">Besoin d'aide ?</h5>
          <p class="small text-muted mb-4">Notre support est disponible 24/7 pour vous accompagner dans la gestion de
            votre compte.</p>
          <button class="btn btn-primary w-100 rounded-pill">Contacter le support</button>
        </div>
      </div>
    </div>
  </div>
</div>

<ng-template #stateTemplate>
  <div class="min-vh-50 d-flex flex-column align-items-center justify-content-center py-5" *ngIf="loading">
    <div class="spinner-border text-primary mb-3" style="width: 3rem; height: 3rem;" role="status text-center"></div>
    <h5 class="text-muted">Chargement de votre profil...</h5>
  </div>

  <div class="card premium-card border-0 shadow-sm p-5 text-center my-5" *ngIf="errorMsg">
    <div class="mb-4">
      <i class="bi bi-exclamation-triangle display-3 text-danger"></i>
    </div>
    <h3 class="fw-bold text-danger mb-3">Oups! Une erreur est survenue</h3>
    <p class="text-muted mb-4">{{ errorMsg }}</p>
    <div>
      <button class="btn btn-primary rounded-pill px-5 py-2" (click)="load()">
        Réessayer <i class="bi bi-arrow-clockwise ms-2"></i>
      </button>
    </div>
  </div>
</ng-template>