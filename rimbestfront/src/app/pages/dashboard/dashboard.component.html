<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h1 class="display-6">
      <i class="bi bi-speedometer2 text-primary me-2"></i>Dashboard
    </h1>
    <p class="text-muted mb-0">
      Bienvenue —
      <span class="badge bg-info ms-1" *ngIf="isAdmin()">ADMIN</span>
      <span class="badge bg-primary ms-1" *ngIf="isPartenaire()">PARTENAIRE</span>
      <span class="badge bg-success ms-1" *ngIf="isClient()">CLIENT</span>
    </p>
  </div>

  <div class="d-flex gap-2">
    <a class="btn btn-outline-primary" routerLink="/search" *ngIf="isClient()">
      <i class="bi bi-search me-1"></i>Rechercher
    </a>
    <a class="btn btn-outline-secondary" routerLink="/reservations">
      <i class="bi bi-calendar-check me-1"></i>Réservations
    </a>
    <button class="btn btn-primary" type="button" (click)="load()" [disabled]="loading">
      <i class="bi bi-arrow-repeat me-1"></i>Actualiser
    </button>
  </div>
</div>

<div *ngIf="errorMsg" class="alert alert-danger py-2">{{ errorMsg }}</div>
<div *ngIf="loading" class="alert alert-info py-2">
  <i class="bi bi-arrow-repeat me-2"></i>Chargement...
</div>

<div *ngIf="data && !loading">
  <!-- Cartes stats -->
  <div class="row g-3 mb-4">
    <div class="col-md-3">
      <div class="card bg-primary bg-opacity-10 border-primary shadow-sm">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div>
              <div class="text-primary small">Hôtels</div>
              <div class="fs-3 fw-bold text-primary">{{ data.stats.totalHotels ?? '-' }}</div>
            </div>
            <i class="bi bi-buildings text-primary fs-1"></i>
          </div>
          <a routerLink="/hotel/list" class="small text-decoration-none">Gérer</a>
        </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card bg-info bg-opacity-10 border-info shadow-sm">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div>
              <div class="text-info small">Chambres</div>
              <div class="fs-3 fw-bold text-info">{{ data.stats.totalChambres ?? '-' }}</div>
            </div>
            <i class="bi bi-door-closed text-info fs-1"></i>
          </div>
          <span class="small text-muted" *ngIf="isAdmin() || isPartenaire()">Par hôtels</span>
        </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card bg-warning bg-opacity-10 border-warning shadow-sm">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div>
              <div class="text-warning small">Réservations</div>
              <div class="fs-3 fw-bold text-warning">{{ data.stats.totalReservations ?? '-' }}</div>
            </div>
            <i class="bi bi-calendar-check text-warning fs-1"></i>
          </div>
          <span class="small text-muted">Toutes</span>
        </div>
      </div>
    </div>

    <div class="col-md-3" *ngIf="isAdmin() || isPartenaire()">
      <div class="card bg-success bg-opacity-10 border-success shadow-sm">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div>
              <div class="text-success small">En attente</div>
              <div class="fs-3 fw-bold text-success">{{ data.stats.reservationsEnAttente ?? '-' }}</div>
            </div>
            <i class="bi bi-hourglass-split text-success fs-1"></i>
          </div>
          <a routerLink="/reservations" class="small text-decoration-none">Traiter</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Raccourcis -->
  <div class="row g-3 mb-4">
    <div class="col-md-4" *ngIf="isAdmin() || isPartenaire()">
      <div class="card shadow-sm h-100">
        <div class="card-body">
          <h5><i class="bi bi-buildings me-2 text-primary"></i>Gestion Hôtels</h5>
          <p class="text-muted mb-3">Ajouter, modifier, activer/désactiver.</p>
          <a class="btn btn-outline-primary" routerLink="/hotel/list">
            Ouvrir <i class="bi bi-arrow-right ms-1"></i>
          </a>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card shadow-sm h-100">
        <div class="card-body">
          <h5><i class="bi bi-calendar-check me-2 text-success"></i>Réservations</h5>
          <p class="text-muted mb-3">
            <span *ngIf="isClient()">Voir et gérer vos réservations.</span>
            <span *ngIf="isAdmin() || isPartenaire()">Valider / refuser les demandes.</span>
          </p>
          <a class="btn btn-outline-success" routerLink="/reservations">
            Ouvrir <i class="bi bi-arrow-right ms-1"></i>
          </a>
        </div>
      </div>
    </div>

    <div class="col-md-4" *ngIf="isClient()">
      <div class="card shadow-sm h-100">
        <div class="card-body">
          <h5><i class="bi bi-search me-2 text-primary"></i>Recherche</h5>
          <p class="text-muted mb-3">Trouver une chambre disponible et réserver.</p>
          <a class="btn btn-outline-primary" routerLink="/search">
            Rechercher <i class="bi bi-arrow-right ms-1"></i>
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Dernières réservations -->
  <div class="card shadow">
    <div class="card-header bg-white d-flex justify-content-between align-items-center">
      <h5 class="mb-0"><i class="bi bi-clock-history me-2"></i>Dernières réservations</h5>
      <a routerLink="/reservations" class="btn btn-sm btn-outline-primary">
        Voir tout <i class="bi bi-arrow-right ms-1"></i>
      </a>
    </div>

    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-hover align-middle">
          <thead class="table-light">
            <tr>
              <th>#</th>
              <th>Hôtel</th>
              <th>Chambre</th>
              <th>Dates</th>
              <th *ngIf="isAdmin() || isPartenaire()">Client</th>
              <th>Statut</th>
              <th>Prix</th>
              <th></th>
            </tr>
          </thead>

          <tbody>
            <tr *ngFor="let r of data.lastReservations">
              <td class="fw-semibold">{{ r.id }}</td>
              <td>{{ r.hotelNom || '-' }}</td>
              <td>{{ r.chambreNumero || '-' }}</td>
              <td class="small">{{ r.dateDebut }} → {{ r.dateFin }}</td>
              <td *ngIf="isAdmin() || isPartenaire()">{{ r.clientNom || '-' }}</td>
              <td>
                <span class="badge" [ngClass]="badgeClass(r.statut)">{{ r.statut }}</span>
              </td>
              <td>{{ r.prixTotal ?? '-' }}</td>
              <td class="text-end">
                <a class="btn btn-sm btn-outline-primary" [routerLink]="['/reservation/details', r.id]">
                  <i class="bi bi-eye"></i>
                </a>
              </td>
            </tr>

            <tr *ngIf="!data.lastReservations || data.lastReservations.length === 0">
              <td colspan="8" class="text-center py-5 text-muted">
                <i class="bi bi-calendar-x display-1 opacity-25"></i>
                <h5 class="mt-3">Aucune réservation récente</h5>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>