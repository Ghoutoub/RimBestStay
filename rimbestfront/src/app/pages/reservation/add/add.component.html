<div class="row pt-4 pb-5">
  <div class="col-lg-8">
    <div class="card border-0 shadow-sm rounded-4 mb-4">
      <div class="card-body p-4">
        <h2 class="h4 fw-bold mb-4"><i class="bi bi-calendar-plus text-primary me-2"></i>Détails de votre séjour</h2>

        <div *ngIf="errorMsg" class="alert alert-danger rounded-3">{{ errorMsg }}</div>
        <div *ngIf="okMsg" class="alert alert-success rounded-3">{{ okMsg }}</div>

        <!-- Section 1 : Hôtel -->
        <!-- <div class="mb-5">
          <div class="d-flex align-items-center mb-3">
            <div class="step-number me-3">1</div>
            <h5 class="mb-0">Choisir un établissement</h5>
          </div>
          <div class="row g-3">
            <div class="col-md-9">
              <select class="form-select form-select-lg rounded-3 border-light shadow-sm bg-light" [formGroup]="form"
                formControlName="hotelId" (change)="onHotelChange()">
                <option [ngValue]="null">-- Sélectionnez un hôtel --</option>
                <option *ngFor="let h of hotels" [ngValue]="h.id">
                  {{ h.nom }} — {{ h.ville }} ({{ h.etoiles }}★)
                </option>
              </select>
            </div>
            <div class="col-md-3">
              <button class="btn btn-outline-primary btn-lg w-100 rounded-3" (click)="loadHotels()">
                <i class="bi bi-arrow-clockwise"></i>
              </button>
            </div>
          </div>
        </div> -->

        <!-- Section 2 : Dates -->
        <div class="mb-5">
          <div class="d-flex align-items-center mb-3">
            <div class="step-number me-3">2</div>
            <h5 class="mb-0">Vos dates de voyage</h5>
          </div>
          <div class="row g-3" [formGroup]="form">
            <div class="col-md-5">
              <label class="form-label text-muted small">Date d'arrivée</label>
              <input type="date" class="form-control form-control-lg rounded-3 border-light shadow-sm bg-light"
                formControlName="dateDebut" />
            </div>
            <div class="col-md-5">
              <label class="form-label text-muted small">Date de départ</label>
              <input type="date" class="form-control form-control-lg rounded-3 border-light shadow-sm bg-light"
                formControlName="dateFin" />
            </div>
            <div class="col-md-2">
              <label class="form-label text-muted small">Voyageurs</label>
              <input type="number" class="form-control form-control-lg rounded-3 border-light shadow-sm bg-light"
                formControlName="nbPersonnes" />
            </div>
            <div class="col-12 mt-3">
              <button class="btn btn-primary btn-lg rounded-pill px-4 shadow-sm" (click)="loadAvailableRooms()"
                [disabled]="loadingRooms">
                {{ loadingRooms ? 'Calcul des dispos...' : 'Découvrir les chambres disponibles' }}
              </button>
            </div>
          </div>
        </div>

        <!-- Section 3 : Chambre -->
        <div *ngIf="chambres.length > 0" class="mb-4 animate__animated animate__fadeIn">
          <div class="d-flex align-items-center mb-4">
            <div class="step-number me-3">3</div>
            <h5 class="mb-0">Sélectionnez votre confort</h5>
          </div>
          <div class="row g-3">
            <div class="col-md-6" *ngFor="let c of chambres">
              <div class="card h-100 border-0 shadow-sm room-select-card"
                [class.selected]="form.value.chambreId === c.id" (click)="form.patchValue({ chambreId: c.id })">
                <div class="card-body p-3">
                  <div class="d-flex justify-content-between mb-2">
                    <span class="badge bg-primary bg-opacity-10 text-primary">{{ c.type }}</span>
                    <span class="fw-bold">{{ c.prixParNuit }} MRU</span>
                  </div>
                  <h6 class="fw-bold mb-1">Chambre {{ c.numero }}</h6>
                  <p class="text-muted small mb-3">Capacité: {{ c.capacite }} pers.</p>
                  <div class="text-primary small" *ngIf="form.value.chambreId === c.id">
                    <i class="bi bi-check-circle-fill me-1"></i> Sélectionnée
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Résumé Card -->
  <div class="col-lg-4">
    <div class="premium-card sticky-top shadow-lg">
      <div class="card-body p-4">
        <!-- Profil de l'utilisateur qui réserve -->
        <div class="d-flex align-items-center gap-3 p-3 mb-4 rounded-4 bg-light border border-primary border-opacity-10"
          *ngIf="auth.currentUser$ | async as user">
          <div class="user-avatar bg-premium-gradient shadow-sm" style="width: 48px; height: 48px; font-size: 1.2rem;">
            {{ user.nom.charAt(0) }}
          </div>
          <div class="flex-grow-1">
            <p class="text-muted mb-0 lh-1"
              style="font-size: .75rem; text-transform: uppercase; letter-spacing: 0.05em;">Réserver en tant que</p>
            <p class="fw-bold text-main mb-0" style="font-size: 1rem">{{ user.nom }}</p>
          </div>
          <div class="text-primary opacity-50"><i class="bi bi-shield-check fs-4"></i></div>
        </div>

        <h5 class="fw-bold mb-4 text-primary"><i class="bi bi-receipt me-2"></i>Récapitulatif</h5>
        <div *ngIf="!selectedChambre" class="text-center py-4 text-muted">
          <i class="bi bi-ticket-perforated display-4 d-block mb-3"></i>
          Complétez les étapes pour voir le récapitulatif
        </div>

        <div *ngIf="selectedChambre">
          <div class="d-flex justify-content-between mb-3 border-bottom pb-3">
            <span class="text-muted">Séjour</span>
            <span class="fw-bold">{{ nights() }} nuit(s)</span>
          </div>
          <div class="d-flex justify-content-between mb-3">
            <span class="text-muted">Prix chambre</span>
            <span>{{ nights() }} x {{ selectedChambre.prixParNuit }} MRU</span>
          </div>
          <div class="d-flex justify-content-between mb-4">
            <span class="text-muted">Taxe de séjour</span>
            <span>{{ taxeSejour() }} MRU</span>
          </div>

          <div class="d-flex justify-content-between align-items-center bg-light p-3 rounded-3 mb-4">
            <span class="fw-bold h5 mb-0">Total</span>
            <span class="fw-bold h4 text-primary mb-0">{{ total() }} MRU</span>
          </div>

          <button class="btn btn-primary w-100 btn-lg rounded-pill py-3 shadow-sm" [disabled]="creating || form.invalid"
            (click)="submit()">
            {{ creating ? 'Confirmation...' : 'Confirmer la réservation' }} <i class="bi bi-check2-all ms-2"></i>
          </button>

          <p class="text-center text-muted small mt-3">Paiement sécurisé lors de l'arrivée</p>
        </div>
      </div>
    </div>
  </div>
</div>