<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h1 class="display-6"><i class="bi bi-people text-primary me-2"></i>Gestion des Utilisateurs</h1>
    <p class="text-muted mb-0">Administration des comptes clients et partenaires</p>
  </div>
  <div>
    <a routerLink="/admin/users/create" class="btn btn-primary"><i class="bi bi-person-plus me-2"></i>Nouvel
      Utilisateur</a>
  </div>
</div>

<!-- Statistiques -->
<div class="row mb-4">
  <div class="col-md-3">
    <div class="card bg-primary bg-opacity-10 border-primary shadow-sm h-100">
      <div class="card-body">
        <h6 class="text-primary mb-1">Total Utilisateurs</h6>
        <h2 class="text-primary mb-0">{{ totalUsers }}</h2>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card bg-info bg-opacity-10 border-info shadow-sm h-100">
      <div class="card-body">
        <h6 class="text-info mb-1">Clients</h6>
        <h2 class="text-info mb-0">{{ clientsCount }}</h2>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card bg-warning bg-opacity-10 border-warning shadow-sm h-100">
      <div class="card-body">
        <h6 class="text-warning text-dark mb-1">Partenaires</h6>
        <h2 class="text-warning text-dark mb-0">{{ partenairesCount }}</h2>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card bg-danger bg-opacity-10 border-danger shadow-sm h-100">
      <div class="card-body">
        <h6 class="text-danger mb-1">Admins</h6>
        <h2 class="text-danger mb-0">{{ adminsCount }}</h2>
      </div>
    </div>
  </div>
</div>

<!-- Filtres -->
<div class="card shadow-sm mb-4 border-0">
  <div class="card-body bg-light rounded">
    <form (ngSubmit)="onFilter()">
      <div class="row g-3">
        <div class="col-md-4">
          <label class="form-label text-muted small">Recherche</label>
          <div class="input-group">
            <span class="input-group-text bg-white border-end-0"><i class="bi bi-search text-muted"></i></span>
            <input class="form-control border-start-0 ps-0" [(ngModel)]="search" name="search"
              placeholder="Nom ou email">
          </div>
        </div>
        <div class="col-md-3">
          <label class="form-label text-muted small">Rôle</label>
          <select class="form-select" [(ngModel)]="selectedRole" name="role">
            <option value="">Tous les rôles</option>
            <option *ngFor="let r of roles" [value]="r">{{ r.replace('ROLE_','') }}</option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label text-muted small">Statut</label>
          <select class="form-select" [(ngModel)]="selectedEnabled" name="active">
            <option [ngValue]="null">Tous les statuts</option>
            <option [ngValue]="true">Actif</option>
            <option [ngValue]="false">Inactif</option>
          </select>
        </div>
        <div class="col-md-2 d-flex align-items-end">
          <button class="btn btn-primary w-100" type="submit">Filtrer</button>
        </div>
      </div>
    </form>
  </div>
</div>

<!-- Tableau -->
<div class="card shadow border-0">
  <div class="card-header bg-white py-3">
    <h5 class="mb-0"><i class="bi bi-card-list me-2"></i>Liste des utilisateurs <span class="badge bg-secondary ms-2">{{
        users.length }}</span></h5>
  </div>
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-hover align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th class="ps-4">Utilisateur</th>
            <th>Contact</th>
            <th>Rôle(s)</th>
            <th>Inscription</th>
            <th>Statut</th>
            <th class="pe-4 text-end">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let user of users">
            <td class="ps-4">
              <div class="d-flex align-items-center">
                <div
                  class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center fw-bold me-3 shadow-sm"
                  style="width: 40px; height: 40px; font-size: 1.2rem;">
                  {{ user.nom ? user.nom.charAt(0).toUpperCase() : 'U' }}
                </div>
                <div>
                  <div class="fw-bold">{{ user.nom }}</div>
                  <div class="text-muted small">ID: #{{ user.id }}</div>
                </div>
              </div>
            </td>
            <td>
              <a href="mailto:{{ user.email }}" class="text-decoration-none">{{ user.email }}</a>
              <div *ngIf="user.telephone" class="text-muted small"><i class="bi bi-telephone me-1"></i>{{ user.telephone
                }}</div>
            </td>
            <td>
              <span *ngFor="let role of user.roles" class="badge me-1 border"
                [class.bg-danger-subtle]="role.name === 'ROLE_ADMIN'" [class.text-danger]="role.name === 'ROLE_ADMIN'"
                [class.border-danger]="role.name === 'ROLE_ADMIN'"
                [class.bg-warning-subtle]="role.name === 'ROLE_PARTENAIRE'"
                [class.text-dark]="role.name === 'ROLE_PARTENAIRE'"
                [class.border-warning]="role.name === 'ROLE_PARTENAIRE'"
                [class.bg-primary-subtle]="role.name === 'ROLE_CLIENT'"
                [class.text-primary]="role.name === 'ROLE_CLIENT'" [class.border-primary]="role.name === 'ROLE_CLIENT'">
                {{ role.name.replace('ROLE_','') }}
              </span>
            </td>
            <td>
              <div class="small">
                <i class="bi bi-calendar me-1 text-muted"></i>{{ user.createdAt | date:'dd/MM/yyyy' }}
              </div>
            </td>
            <td>
              <span class="badge rounded-pill px-3" [class.bg-success]="user.actif" [class.bg-secondary]="!user.actif">
                {{ user.actif ? 'Actif' : 'Inactif' }}
              </span>
            </td>
            <td class="pe-4 text-end">
              <div class="btn-group shadow-sm">
                <a [routerLink]="['/admin/users', user.id]" class="btn btn-sm btn-light border" title="Voir détails"><i
                    class="bi bi-eye text-primary"></i></a>
                <!-- <a [routerLink]="['/admin/users/edit', user.id]" class="btn btn-sm btn-light border" title="Modifier"><i
                    class="bi bi-pencil text-warning"></i></a> -->
                <button class="btn btn-sm btn-light border" title="Changer statut"
                  (click)="toggleStatus(user.id!, user.actif!)">
                  <i class="bi text-success" [class.bi-toggle-on]="user.actif" [class.bi-toggle-off]="!user.actif"
                    [class.text-secondary]="!user.actif"></i>
                </button>
                <button class="btn btn-sm btn-light border" title="Supprimer" (click)="deleteUser(user.id!)"><i
                    class="bi bi-trash text-danger"></i></button>
              </div>
            </td>
          </tr>
          <tr *ngIf="users.length === 0">
            <td colspan="6" class="text-center py-5">
              <i class="bi bi-people display-1 text-muted opacity-25"></i>
              <h5 class="mt-3 text-muted">Aucun utilisateur trouvé</h5>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>